<div class="admin-lodgings-container">
  <!-- Breadcrumbs -->
  <app-admin-breadcrumbs [items]="breadcrumbs" />

  <!-- Header -->
  <div class="admin-header">
    <div>
      <h1 class="admin-title">Gesti√≥n de Alojamientos</h1>
      <p class="admin-subtitle">
        Administra hoteles, apartamentos, hostels y casas rurales
      </p>
    </div>
    <button class="btn-primary" (click)="openCreateModal()">
      <span class="icon">‚ûï</span>
      Nuevo Alojamiento
    </button>
  </div>

  <!-- Statistics Cards -->
  <div class="stats-grid">
    <app-admin-stat-card
      label="Total Alojamientos"
      [value]="stats().total"
      [change]="0"
      changeLabel=""
      icon="üè®"
      variant="primary"
    />
    <app-admin-stat-card
      label="Activos"
      [value]="stats().active"
      [change]="0"
      changeLabel=""
      icon="‚úÖ"
      variant="success"
    />
    <app-admin-stat-card
      label="Ingresos Totales"
      [value]="stats().revenue"
      [change]="0"
      changeLabel=""
      icon="üí∞"
      variant="info"
      format="currency"
    />
    <app-admin-stat-card
      label="Ocupaci√≥n Media"
      [value]="stats().avgOccupancy + '%'"
      [change]="0"
      changeLabel=""
      icon="üìä"
      variant="warning"
    />
  </div>

  <!-- Search and Filters -->
  <div class="admin-toolbar">
    <app-admin-search-bar
      placeholder="Buscar por nombre, estaci√≥n, ciudad o propietario..."
      (search)="handleSearch($any($event))"
    />
    <app-admin-filters
      [fields]="filterFields"
      (filterChange)="
        handleFilterChange($any($event).filterId, $any($event).value)
      "
    />
  </div>

  <!-- Loading State -->
  @if (isLoading()) {
  <app-admin-loader message="Cargando alojamientos..." />
  }

  <!-- Error State -->
  @else if (error()) {
  <div class="error-message">
    <span class="icon">‚ö†Ô∏è</span>
    <p>{{ error() }}</p>
    <button class="btn-secondary" (click)="loadLodgings()">Reintentar</button>
  </div>
  }

  <!-- Empty State -->
  @else if (filteredLodgings().length === 0) {
  <app-admin-empty-state
    title="No hay alojamientos"
    message="No se encontraron alojamientos con los filtros aplicados"
    icon="üè®"
    [actionLabel]="searchQuery() ? 'Limpiar b√∫squeda' : 'Crear alojamiento'"
    (action)="searchQuery() ? handleSearch('') : openCreateModal()"
  />
  }

  <!-- Table -->
  @else {
  <app-admin-table
    [columns]="tableColumns"
    [data]="paginatedLodgings()"
    [actions]="tableActions"
    (rowClick)="handleRowClick($event)"
    (actionClick)="handleActionClick($any($event))"
  >
    <!-- Custom column templates -->
    <ng-template #customColumn let-column="column" let-row="row">
      @if (column.key === 'type') {
      <span class="lodging-type">{{ getLodgingTypeLabel(row.type) }}</span>
      } @if (column.key === 'priceFrom') {
      <span class="price">{{ row.priceFrom }}‚Ç¨/noche</span>
      } @if (column.key === 'rating') {
      <span class="rating">
        <span class="icon">‚≠ê</span>
        {{ row.rating }} ({{ row.totalReviews }})
      </span>
      } @if (column.key === 'occupancyRate') {
      <span class="occupancy">{{ row.stats.occupancyRate }}%</span>
      } @if (column.key === 'status') {
      <app-admin-badge
        [text]="
          row.status === 'active'
            ? 'Activo'
            : row.status === 'inactive'
            ? 'Inactivo'
            : 'Mantenimiento'
        "
        [variant]="$any(getStatusColor(row.status))"
      />
      }
    </ng-template>
  </app-admin-table>

  <!-- Pagination -->
  <app-admin-pagination
    [page]="currentPage()"
    [total]="totalPages()"
    [pageSize]="itemsPerPage()"
    (pageChange)="handlePageChange($event)"
  />
  }

  <!-- Create/Edit Modal -->
  @if (showModal()) {
  <app-admin-modal
    [open]="true"
    [title]="isEditMode() ? 'Editar Alojamiento' : 'Nuevo Alojamiento'"
    size="lg"
    (close)="closeModal()"
  >
    <div class="modal-content">
      <form class="admin-form">
        <!-- Basic Information -->
        <div class="form-section">
          <h3 class="section-title">Informaci√≥n B√°sica</h3>

          <div class="form-row">
            <div class="form-group">
              <label for="name">Nombre *</label>
              <input
                type="text"
                id="name"
                class="form-input"
                [(ngModel)]="formData().name"
                name="name"
                placeholder="Hotel Monta√±a Nevada"
                required
              />
            </div>

            <div class="form-group">
              <label for="type">Tipo *</label>
              <select
                id="type"
                class="form-select"
                [(ngModel)]="formData().type"
                name="type"
                required
              >
                <option value="hotel">Hotel</option>
                <option value="apartment">Apartamento</option>
                <option value="hostel">Hostel</option>
                <option value="rural">Casa Rural</option>
              </select>
            </div>
          </div>

          <div class="form-row">
            <div class="form-group">
              <label for="station">Estaci√≥n *</label>
              <select
                id="station"
                class="form-select"
                [(ngModel)]="formData().station"
                name="station"
                required
              >
                <option value="">Seleccionar estaci√≥n</option>
                <option value="sierra-nevada">Sierra Nevada</option>
                <option value="baqueira-beret">Baqueira Beret</option>
                <option value="formigal">Formigal</option>
              </select>
            </div>

            <div class="form-group">
              <label for="status">Estado *</label>
              <select
                id="status"
                class="form-select"
                [(ngModel)]="formData().status"
                name="status"
                required
              >
                <option value="active">Activo</option>
                <option value="inactive">Inactivo</option>
                <option value="maintenance">Mantenimiento</option>
              </select>
            </div>
          </div>
        </div>

        <!-- Location -->
        <div class="form-section">
          <h3 class="section-title">Ubicaci√≥n</h3>

          <div class="form-group">
            <label for="address">Direcci√≥n *</label>
            <input
              type="text"
              id="address"
              class="form-input"
              [(ngModel)]="formData().address"
              name="address"
              placeholder="Calle Virgen de las Nieves, 10"
              required
            />
          </div>

          <div class="form-row">
            <div class="form-group">
              <label for="city">Ciudad *</label>
              <input
                type="text"
                id="city"
                class="form-input"
                [(ngModel)]="formData().city"
                name="city"
                placeholder="Monachil"
                required
              />
            </div>

            <div class="form-group">
              <label for="zipCode">C√≥digo Postal *</label>
              <input
                type="text"
                id="zipCode"
                class="form-input"
                [(ngModel)]="formData().zipCode"
                name="zipCode"
                placeholder="18196"
                required
              />
            </div>
          </div>
        </div>

        <!-- Contact -->
        <div class="form-section">
          <h3 class="section-title">Contacto</h3>

          <div class="form-row">
            <div class="form-group">
              <label for="phone">Tel√©fono *</label>
              <input
                type="tel"
                id="phone"
                class="form-input"
                [(ngModel)]="formData().phone"
                name="phone"
                placeholder="+34 958 480 001"
                required
              />
            </div>

            <div class="form-group">
              <label for="email">Email *</label>
              <input
                type="email"
                id="email"
                class="form-input"
                [(ngModel)]="formData().email"
                name="email"
                placeholder="info@hotel.es"
                required
              />
            </div>
          </div>
        </div>

        <!-- Rooms & Pricing -->
        <div class="form-section">
          <h3 class="section-title">Habitaciones y Precios</h3>

          <div class="form-row">
            <div class="form-group">
              <label for="totalRooms">Total Habitaciones *</label>
              <input
                type="number"
                id="totalRooms"
                class="form-input"
                [(ngModel)]="formData().totalRooms"
                name="totalRooms"
                min="1"
                required
              />
            </div>

            <div class="form-group">
              <label for="priceFrom">Precio Desde (‚Ç¨/noche) *</label>
              <input
                type="number"
                id="priceFrom"
                class="form-input"
                [(ngModel)]="formData().priceFrom"
                name="priceFrom"
                min="0"
                step="0.01"
                required
              />
            </div>
          </div>
        </div>

        <!-- Amenities -->
        <div class="form-section">
          <h3 class="section-title">Servicios</h3>
          <div class="amenities-grid">
            @for (amenity of availableAmenities; track amenity) {
            <label class="amenity-checkbox">
              <input
                type="checkbox"
                [checked]="formData().amenities.includes(amenity)"
                (change)="toggleAmenity(amenity)"
              />
              <span>{{ amenity.replace("_", " ") }}</span>
            </label>
            }
          </div>
        </div>

        <!-- Owner Information -->
        <div class="form-section">
          <h3 class="section-title">Propietario</h3>

          <div class="form-group">
            <label for="ownerName">Nombre *</label>
            <input
              type="text"
              id="ownerName"
              class="form-input"
              [(ngModel)]="formData().ownerName"
              name="ownerName"
              placeholder="Garc√≠a Hoteles S.L."
              required
            />
          </div>

          <div class="form-row">
            <div class="form-group">
              <label for="ownerEmail">Email *</label>
              <input
                type="email"
                id="ownerEmail"
                class="form-input"
                [(ngModel)]="formData().ownerEmail"
                name="ownerEmail"
                placeholder="garcia@hotels.es"
                required
              />
            </div>

            <div class="form-group">
              <label for="ownerPhone">Tel√©fono *</label>
              <input
                type="tel"
                id="ownerPhone"
                class="form-input"
                [(ngModel)]="formData().ownerPhone"
                name="ownerPhone"
                placeholder="+34 958 480 002"
                required
              />
            </div>
          </div>

          <div class="form-group">
            <label for="commissionRate">Comisi√≥n (%) *</label>
            <input
              type="number"
              id="commissionRate"
              class="form-input"
              [(ngModel)]="formData().commissionRate"
              name="commissionRate"
              min="0"
              max="100"
              step="0.5"
              required
            />
          </div>
        </div>

        <!-- Featured -->
        <div class="form-section">
          <label class="checkbox-label">
            <input
              type="checkbox"
              [(ngModel)]="formData().featured"
              name="featured"
            />
            <span>Marcar como destacado</span>
          </label>
        </div>

        <!-- Actions -->
        <div class="modal-actions">
          <button type="button" class="btn-secondary" (click)="closeModal()">
            Cancelar
          </button>
          <button type="button" class="btn-primary" (click)="handleSave()">
            {{ isEditMode() ? "Guardar Cambios" : "Crear Alojamiento" }}
          </button>
        </div>
      </form>
    </div>
  </app-admin-modal>
  }

  <!-- Delete Confirmation Dialog -->
  @if (showDeleteDialog()) {
  <app-admin-confirm-dialog
    [open]="true"
    title="Eliminar Alojamiento"
    [message]="
      '¬øEst√°s seguro de que quieres eliminar ' +
      selectedLodging()?.name +
      '? Esta acci√≥n no se puede deshacer.'
    "
    confirmLabel="Eliminar"
    cancelLabel="Cancelar"
    variant="danger"
    (confirm)="handleDelete()"
    (cancel)="closeDeleteDialog()"
  />
  }
</div>
