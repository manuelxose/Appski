<!-- Planner Form -->
<div class="bg-white rounded-xl shadow-lg p-6">
  <h2 class="text-2xl font-bold text-slate-900 mb-6">ğŸ“‹ Planifica tu Viaje</h2>

  <form (ngSubmit)="submitPlan()" class="space-y-6">
    <!-- Destination - Visual Station Selector -->
    <fieldset>
      <legend class="block text-sm font-semibold text-slate-700 mb-3">
        ğŸ“ Selecciona tu estaciÃ³n de esquÃ­
      </legend>
      <div class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-4">
        @for (station of (stations().length > 0 ? stations() : defaultStations);
        track station.name) {
        <button
          type="button"
          (click)="selectStation(station.name)"
          class="relative overflow-hidden rounded-xl transition-all duration-300 hover:scale-[1.02] group"
          [class.ring-4]="isStationSelected(station.name)"
          [class.ring-blue-500]="isStationSelected(station.name)"
          [class.shadow-xl]="isStationSelected(station.name)"
        >
          <!-- Image -->
          <div class="aspect-video relative">
            <img
              [src]="station.image"
              [alt]="station.name"
              class="w-full h-full object-cover"
            />
            <div
              class="absolute inset-0 bg-gradient-to-t from-black/80 via-black/30 to-transparent"
            ></div>

            <!-- Status Badge -->
            @if (station.isOpen) {
            <div
              class="absolute top-2 right-2 px-2 py-1 bg-green-500 text-white text-xs font-bold rounded-full flex items-center gap-1"
            >
              <span class="w-2 h-2 bg-white rounded-full animate-pulse"></span>
              Abierta
            </div>
            } @else {
            <div
              class="absolute top-2 right-2 px-2 py-1 bg-red-500 text-white text-xs font-bold rounded-full"
            >
              Cerrada
            </div>
            }

            <!-- Selected Check -->
            @if (isStationSelected(station.name)) {
            <div
              class="absolute top-2 left-2 w-8 h-8 bg-blue-500 text-white rounded-full flex items-center justify-center shadow-lg"
            >
              <svg
                xmlns="http://www.w3.org/2000/svg"
                class="h-5 w-5"
                viewBox="0 0 20 20"
                fill="currentColor"
              >
                <path
                  fill-rule="evenodd"
                  d="M16.707 5.293a1 1 0 010 1.414l-8 8a1 1 0 01-1.414 0l-4-4a1 1 0 011.414-1.414L8 12.586l7.293-7.293a1 1 0 011.414 0z"
                  clip-rule="evenodd"
                />
              </svg>
            </div>
            }

            <!-- Content -->
            <div class="absolute bottom-0 left-0 right-0 p-3 text-white">
              <h3 class="font-bold text-lg mb-1">{{ station.name }}</h3>
              <p class="text-xs text-gray-200 mb-2">{{ station.location }}</p>

              <!-- Snow Data -->
              <div class="grid grid-cols-3 gap-2 text-xs">
                <div
                  class="flex flex-col items-center bg-white/20 backdrop-blur-sm rounded px-2 py-1"
                >
                  <span class="font-bold">{{ station.snowBase }}cm</span>
                  <span class="text-[10px] opacity-80">Base</span>
                </div>
                <div
                  class="flex flex-col items-center bg-white/20 backdrop-blur-sm rounded px-2 py-1"
                >
                  <span class="font-bold">{{ station.snowFresh }}cm</span>
                  <span class="text-[10px] opacity-80">Fresca</span>
                </div>
                <div
                  class="flex flex-col items-center bg-white/20 backdrop-blur-sm rounded px-2 py-1"
                >
                  <span class="font-bold">{{ station.temperature }}Â°C</span>
                  <span class="text-[10px] opacity-80">Temp</span>
                </div>
              </div>
            </div>
          </div>
        </button>
        }
      </div>

      @if (destination()) {
      <div class="mt-3 p-3 bg-blue-50 border-l-4 border-blue-500 rounded">
        <p class="text-sm text-blue-700 font-semibold">
          âœ“ Has seleccionado: {{ destination() }}
        </p>
      </div>
      }
    </fieldset>

    <!-- Dates -->
    <div class="grid grid-cols-1 md:grid-cols-2 gap-4">
      <div>
        <label
          for="startDate"
          class="block text-sm font-semibold text-slate-700 mb-2"
        >
          ğŸ“… Fecha de Inicio
        </label>
        <input
          type="date"
          id="startDate"
          [(ngModel)]="startDate"
          name="startDate"
          required
          class="w-full px-4 py-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent"
        />
      </div>
      <div>
        <label
          for="endDate"
          class="block text-sm font-semibold text-slate-700 mb-2"
        >
          ğŸ“… Fecha de Fin
        </label>
        <input
          type="date"
          id="endDate"
          [(ngModel)]="endDate"
          name="endDate"
          required
          class="w-full px-4 py-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent"
        />
      </div>
    </div>

    @if (getDuration() > 0) {
    <div class="bg-blue-50 border-l-4 border-blue-500 p-4 rounded">
      <p class="text-blue-700 font-semibold">
        â±ï¸ DuraciÃ³n: {{ getDuration() }}
        {{ getDuration() === 1 ? "dÃ­a" : "dÃ­as" }}
      </p>
    </div>
    }

    <!-- People -->
    <div class="grid grid-cols-1 md:grid-cols-2 gap-4">
      <div>
        <label
          for="adults"
          class="block text-sm font-semibold text-slate-700 mb-2"
        >
          ğŸ‘¨â€ğŸ‘©â€ğŸ‘§ Adultos
        </label>
        <input
          type="number"
          id="adults"
          [(ngModel)]="adults"
          name="adults"
          min="1"
          max="10"
          required
          class="w-full px-4 py-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent"
        />
      </div>
      <div>
        <label
          for="children"
          class="block text-sm font-semibold text-slate-700 mb-2"
        >
          ğŸ‘¶ NiÃ±os
        </label>
        <input
          type="number"
          id="children"
          [(ngModel)]="children"
          name="children"
          min="0"
          max="10"
          class="w-full px-4 py-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent"
        />
      </div>
    </div>

    <!-- Budget -->
    <div>
      <label
        for="budget"
        class="block text-sm font-semibold text-slate-700 mb-2"
      >
        ğŸ’° Presupuesto Total (â‚¬)
      </label>
      <input
        type="range"
        id="budget"
        [(ngModel)]="budget"
        name="budget"
        min="500"
        max="5000"
        step="100"
        class="w-full h-2 bg-gray-200 rounded-lg appearance-none cursor-pointer accent-blue-600 mb-2"
      />
      <div class="flex justify-between text-sm">
        <span class="text-slate-600">500â‚¬</span>
        <span class="font-bold text-blue-600 text-xl">{{ budget() }}â‚¬</span>
        <span class="text-slate-600">5000â‚¬</span>
      </div>
    </div>

    <!-- Accommodation Type -->
    <div>
      <div class="block text-sm font-semibold text-slate-700 mb-3">
        ğŸ¨ Tipo de Alojamiento
      </div>
      <div class="grid grid-cols-2 md:grid-cols-4 gap-3">
        @for (type of accommodationTypes; track type.value) {
        <label
          class="relative flex items-center justify-center p-4 border-2 rounded-lg cursor-pointer transition-all"
          [class.border-blue-500]="accommodationType() === type.value"
          [class.bg-blue-50]="accommodationType() === type.value"
          [class.border-gray-200]="accommodationType() !== type.value"
        >
          <input
            type="radio"
            [(ngModel)]="accommodationType"
            name="accommodationType"
            [value]="type.value"
            class="sr-only"
          />
          <span class="text-center">
            <div class="text-2xl mb-1">{{ type.label.split(" ")[0] }}</div>
            <div class="text-xs font-semibold">
              {{ type.label.split(" ")[1] }}
            </div>
          </span>
        </label>
        }
      </div>
    </div>

    <!-- Skill Level -->
    <div>
      <div class="block text-sm font-semibold text-slate-700 mb-3">
        ğŸ¯ Nivel de EsquÃ­
      </div>
      <div class="grid grid-cols-2 md:grid-cols-4 gap-3">
        @for (level of skillLevels; track level.value) {
        <label
          class="relative flex items-center justify-center p-4 border-2 rounded-lg cursor-pointer transition-all"
          [class.border-green-500]="skillLevel() === level.value"
          [class.bg-green-50]="skillLevel() === level.value"
          [class.border-gray-200]="skillLevel() !== level.value"
        >
          <input
            type="radio"
            [(ngModel)]="skillLevel"
            name="skillLevel"
            [value]="level.value"
            class="sr-only"
          />
          <span class="text-center">
            <div class="text-2xl mb-1">{{ level.label.split(" ")[0] }}</div>
            <div class="text-xs font-semibold">
              {{ level.label.split(" ")[1] }}
            </div>
          </span>
        </label>
        }
      </div>
    </div>

    <!-- Activities -->
    <div>
      <div class="block text-sm font-semibold text-slate-700 mb-3">
        ğŸ¿ Actividades de InterÃ©s
      </div>
      <div class="grid grid-cols-2 md:grid-cols-4 gap-3">
        @for (activity of activities; track activity.value) {
        <label
          class="relative flex flex-col items-center p-4 border-2 rounded-lg cursor-pointer transition-all hover:shadow-md"
          [class.border-purple-500]="
            selectedActivities().includes(activity.value)
          "
          [class.bg-purple-50]="selectedActivities().includes(activity.value)"
          [class.border-gray-200]="
            !selectedActivities().includes(activity.value)
          "
        >
          <input
            type="checkbox"
            [checked]="selectedActivities().includes(activity.value)"
            (change)="onActivityToggle(activity.value)"
            class="sr-only"
          />
          <span class="text-3xl mb-2">{{ activity.icon }}</span>
          <span class="text-xs font-semibold text-center">{{
            activity.label
          }}</span>
        </label>
        }
      </div>
    </div>

    <!-- Submit Button -->
    <div class="pt-4">
      <button
        type="submit"
        [disabled]="!isFormValid()"
        class="w-full px-6 py-4 bg-gradient-to-r from-blue-600 to-purple-600 text-white font-bold rounded-lg shadow-lg hover:shadow-xl transition-all disabled:opacity-50 disabled:cursor-not-allowed"
      >
        âœ¨ Generar Plan de Viaje
      </button>
    </div>
  </form>
</div>
